<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Magic Prize</title>
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
  </head>
  <style>
    body {
      margin: 0 auto;
      padding: 0;
      background: #000000;
      max-width: 1920px;
    }
    img {
      width: 100%;
      margin-bottom: -7px;
      transition: filter 0.3s ease, opacity 0.3s ease;
    }
    img.low-res {
      filter: blur(5px);
    }
    img.high-res {
      filter: blur(0);
    }
    #image-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .lazy {
      display: flex;
      /* max-width: 1000px; */
    }

    .lds-ellipsis,
    .lds-ellipsis div {
      box-sizing: border-box;
    }
    .lds-ellipsis {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      z-index: 1000;
    }
    .lds-ellipsis.active {
      display: inline-block;
    }
    .lds-ellipsis div {
      position: absolute;
      top: 33.33333px;
      width: 13.33333px;
      height: 13.33333px;
      border-radius: 50%;
      background: #661999;
      /* background: linear-gradient(
        25deg,
        rgba(110, 42, 155, 1) 0%,
        rgba(190, 87, 199, 1) 59%,
        rgba(237, 83, 183, 1) 100%
      ); */
      animation-timing-function: cubic-bezier(0, 1, 1, 0);
    }
    .lds-ellipsis div:nth-child(1) {
      left: 8px;
      animation: lds-ellipsis1 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(2) {
      left: 8px;
      animation: lds-ellipsis2 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(3) {
      left: 32px;
      animation: lds-ellipsis2 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(4) {
      left: 56px;
      animation: lds-ellipsis3 0.6s infinite;
    }
    @keyframes lds-ellipsis1 {
      0% {
        transform: scale(0);
      }
      100% {
        transform: scale(1);
      }
    }
    @keyframes lds-ellipsis3 {
      0% {
        transform: scale(1);
      }
      100% {
        transform: scale(0);
      }
    }
    @keyframes lds-ellipsis2 {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(24px, 0);
      }
    }
  </style>
  <body>
    <div class="lds-ellipsis" id="loader">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
    </div>
    <div id="image-container"></div>
    <script>
      (function () {
        const imageContainer = document.getElementById("image-container");
        const loader = document.getElementById("loader");
        let currentBucket;

        function progressiveLoadImages() {
          const images = document.querySelectorAll("img.lazy");
          let loadedCount = 0;
          const totalImages = images.length;

          // Show loader
          if (loader) {
            loader.classList.add("active");
          }

          // Load low-res images first
          images.forEach((img, index) => {
            const lowResImage = new Image();
            const highResSrc = img.dataset.src;
            // const lowResSrc = highResSrc.replace(/\/\d+\//, "/blur/");
            const lowResSrc = highResSrc.replace(/\.png/, "_blur.png");

            // Load low-res first
            lowResImage.onload = function () {
              img.src = lowResSrc;
              img.classList.add("low-res");
              img.style.opacity = "1";

              // Then load high-res
              const highResImage = new Image();
              highResImage.onload = function () {
                img.src = highResSrc;
                img.classList.remove("low-res");
                img.classList.add("high-res");
                img.classList.remove("lazy");

                // Hide loader specifically after 1.png loads
                if (highResSrc.endsWith("1.png") && loader) {
                  loader.classList.remove("active");
                }
              };
              highResImage.src = highResSrc;
            };
            lowResImage.src = lowResSrc;
          });
        }

        function updateImages() {
          const screenWidth =
            document.documentElement.clientWidth || window.innerWidth;
          let newBucket = 1920; // Default size

          if (screenWidth <= 360) {
            newBucket = 360;
          } else if (screenWidth <= 480) {
            newBucket = 480;
          } else if (screenWidth <= 640) {
            newBucket = 640;
          } else if (screenWidth <= 960) {
            newBucket = 960;
          }

          if (newBucket !== currentBucket) {
            currentBucket = newBucket;
            let imagesHtml = "";
            let imgExt = ".png";
            for (let i = 1; i <= 5; i++) {
              if (i > 1) {
                imgExt = ".jpg";
              }
              imagesHtml +=
                '<img data-src="adaptive/' +
                currentBucket +
                "/p" +
                i +
                imgExt +
                '" class="lazy" loading="lazy" style="opacity: 0; transition: opacity 0.3s;"/>';
            }
            imageContainer.innerHTML = imagesHtml;
            progressiveLoadImages();
          }
        }

        window.addEventListener("resize", updateImages);
        updateImages(); // Initial call
      })();
    </script>
  </body>
</html>
