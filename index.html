<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Magic Prize</title>
  </head>
  <style>
    body {
      margin: 0 auto;
      padding: 0;
      background: #000000;
      max-width: 1920px;
    }
    img {
      width: 100%;
      margin-bottom: -7px;
    }
    #image-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .lazy {
      display: flex;
      max-width: 1000px;
    }

    .loader {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: none;
      margin: 15px auto;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      box-sizing: border-box;
      animation: animloader 2s linear infinite;
      z-index: 1000;
    }

    .loader.active {
      display: block;
    }

    @keyframes animloader {
      0% {
        box-shadow: 14px 0 0 -2px, 38px 0 0 -2px, -14px 0 0 -2px, -38px 0 0 -2px;
      }
      25% {
        box-shadow: 14px 0 0 -2px, 38px 0 0 -2px, -14px 0 0 -2px, -38px 0 0 2px;
      }
      50% {
        box-shadow: 14px 0 0 -2px, 38px 0 0 -2px, -14px 0 0 2px, -38px 0 0 -2px;
      }
      75% {
        box-shadow: 14px 0 0 2px, 38px 0 0 -2px, -14px 0 0 -2px, -38px 0 0 -2px;
      }
      100% {
        box-shadow: 14px 0 0 -2px, 38px 0 0 2px, -14px 0 0 -2px, -38px 0 0 -2px;
      }
    }
  </style>
  <body>
    <span class="loader" id="loader"></span>
    <div id="image-container"></div>
    <script>
      (function () {
        const imageContainer = document.getElementById("image-container");
        const loader = document.getElementById("loader");
        let currentBucket;

        function lazyLoadImages() {
          const lazyImages = document.querySelectorAll("img.lazy");
          let loadedCount = 0;
          const totalImages = lazyImages.length;

          // Show loader
          loader.classList.add("active");

          // Load all images
          lazyImages.forEach((img) => {
            const actualImage = new Image();
            actualImage.onload = function () {
              img.src = img.dataset.src;
              img.classList.remove("lazy");
              img.style.opacity = "1";
              loadedCount++;
              
              // Hide loader when all images are loaded
              if (loadedCount === totalImages) {
                loader.classList.remove("active");
              }
            };
            actualImage.src = img.dataset.src;
          });
        }

        function updateImages() {
          const screenWidth =
            document.documentElement.clientWidth || window.innerWidth;
          let newBucket = 1920; // Default size

          if (screenWidth <= 360) {
            newBucket = 360;
          } else if (screenWidth <= 480) {
            newBucket = 480;
          } else if (screenWidth <= 640) {
            newBucket = 640;
          } else if (screenWidth <= 960) {
            newBucket = 960;
          }

          if (newBucket !== currentBucket) {
            currentBucket = newBucket;
            let imagesHtml = "";
            for (let i = 1; i <= 5; i++) {
              imagesHtml +=
                '<img data-src="adaptive/' +
                currentBucket +
                "/p" +
                i +
                '.png" class="lazy" loading="lazy" style="opacity: 0; transition: opacity 0.3s;"/>';
            }
            imageContainer.innerHTML = imagesHtml;
            lazyLoadImages();
          }
        }

        window.addEventListener("resize", updateImages);
        updateImages(); // Initial call
      })();
    </script>
  </body>
</html>
